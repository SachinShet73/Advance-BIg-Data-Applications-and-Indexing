# Structured Data REST API

[![Node.js](https://img.shields.io/badge/Node.js-16+-green.svg)](https://nodejs.org/)
[![Express](https://img.shields.io/badge/Express-4.18+-blue.svg)](https://expressjs.com/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

A production-ready REST API for handling structured JSON data with comprehensive validation, conditional reads, and key/value storage. Built with Node.js, Express, and JSON Schema validation.

## 🚀 Features

- ✅ **Full CRUD Operations**: POST, GET, DELETE with proper REST semantics
- ✅ **JSON Schema Validation**: Real-time payload validation with detailed error reporting
- ✅ **Conditional Reads**: ETags support for efficient caching and bandwidth optimization
- ✅ **Key/Value Storage**: High-performance in-memory storage with metadata tracking
- ✅ **API Versioning**: Future-proof versioned endpoints (`/api/v1`)
- ✅ **Security Headers**: Helmet.js integration for security best practices
- ✅ **CORS Support**: Cross-origin resource sharing enabled
- ✅ **Request Logging**: Morgan middleware for comprehensive request logging
- ✅ **Error Handling**: Standardized error responses with proper HTTP status codes
- ✅ **Health Monitoring**: Built-in health check endpoint

## 📋 Table of Contents

- [Quick Start](#-quick-start)
- [API Documentation](#-api-documentation)
- [Data Model](#-data-model)
- [Usage Examples](#-usage-examples)
- [Architecture](#-architecture)
- [Testing](#-testing)
- [Contributing](#-contributing)

## ⚡ Quick Start

```bash
# Clone the repository
git clone <repository-url>
cd structured-data-rest-api

# Install dependencies
npm install

# Start the development server
npm run dev

# Or start production server
npm start
```

The API will be available at `http://localhost:3000`

## 📚 API Documentation

### Base URL: `/api/v1`

| Method | Endpoint | Description | Status Codes |
|--------|----------|-------------|--------------|
| `POST` | `/data` | Create new data record | `201`, `400`, `409`, `500` |
| `GET` | `/data/{id}` | Retrieve specific record | `200`, `304`, `404`, `500` |
| `GET` | `/data` | List all records | `200`, `500` |
| `DELETE` | `/data/{id}` | Delete specific record | `204`, `404`, `500` |
| `GET` | `/health` | Health check endpoint | `200` |

### 🔧 Request/Response Headers

| Header | Usage | Description |
|--------|-------|-------------|
| `Content-Type` | Request/Response | Always `application/json` |
| `ETag` | Response | Entity tag for caching |
| `If-None-Match` | Request | Conditional read support |
| `Location` | Response | URI of created resource |
| `Cache-Control` | Response | Caching directives |

### 📊 HTTP Status Codes

| Code | Meaning | When Used |
|------|---------|-----------|
| `200` | OK | Successful GET request |
| `201` | Created | Resource created successfully |
| `204` | No Content | Resource deleted successfully |
| `304` | Not Modified | Resource unchanged (conditional read) |
| `400` | Bad Request | Validation failed |
| `404` | Not Found | Resource not found |
| `409` | Conflict | Resource already exists |
| `500` | Server Error | Internal server error |

## 🗂️ Data Model

The API accepts structured JSON data conforming to this schema:

### Request Schema (POST /data)

```json
{
  "id": "user-123",                    // Required: 1-100 chars, alphanumeric + _-
  "name": "John Doe",                  // Required: 1-255 chars
  "type": "user",                      // Required: user|product|order|category
  "attributes": {                      // Optional: dynamic properties
    "email": "john@example.com",
    "age": 30,
    "preferences": ["music", "sports"]
  }
}
```

### Response Schema (GET /data/{id})

```json
{
  "id": "user-123",
  "name": "John Doe",
  "type": "user",
  "attributes": {
    "email": "john@example.com",
    "age": 30,
    "preferences": ["music", "sports"]
  },
  "metadata": {                        // Auto-generated by server
    "createdAt": "2023-12-01T10:00:00.000Z",
    "updatedAt": "2023-12-01T10:00:00.000Z",
    "version": 1
  }
}
```

### Field Validation Rules

| Field | Type | Required | Constraints |
|-------|------|----------|-------------|
| `id` | string | ✅ | 1-100 chars, alphanumeric + underscore + hyphen |
| `name` | string | ✅ | 1-255 characters |
| `type` | string | ✅ | Must be one of: `user`, `product`, `order`, `category` |
| `attributes` | object | ❌ | Flexible object with any valid JSON properties |
| `metadata` | object | ❌ | Auto-generated, contains timestamps and version |

## 💡 Usage Examples

### 1. Create a New Record

**Request:**
```bash
curl -X POST http://localhost:3000/api/v1/data \
  -H "Content-Type: application/json" \
  -d '{
    "id": "user-123",
    "name": "John Doe",
    "type": "user",
    "attributes": {
      "email": "john@example.com",
      "age": 30,
      "department": "Engineering"
    }
  }'
```

**Response (201 Created):**
```json
{
  "message": "Resource created successfully",
  "id": "user-123",
  "version": 1,
  "timestamp": "2023-12-01T10:00:00.000Z"
}
```

**Headers:**
```
ETag: "a1b2c3d4"
Location: /api/v1/data/user-123
```

### 2. Retrieve a Record

**Request:**
```bash
curl -X GET http://localhost:3000/api/v1/data/user-123
```

**Response (200 OK):**
```json
{
  "id": "user-123",
  "name": "John Doe",
  "type": "user",
  "attributes": {
    "email": "john@example.com",
    "age": 30,
    "department": "Engineering"
  },
  "metadata": {
    "createdAt": "2023-12-01T10:00:00.000Z",
    "updatedAt": "2023-12-01T10:00:00.000Z",
    "version": 1
  }
}
```

### 3. Conditional Read (Caching)

**Request:**
```bash
curl -X GET http://localhost:3000/api/v1/data/user-123 \
  -H "If-None-Match: \"a1b2c3d4\""
```

**Response (304 Not Modified):**
```
Status: 304 Not Modified
ETag: "a1b2c3d4"
(Empty body)
```

### 4. List All Records

**Request:**
```bash
curl -X GET http://localhost:3000/api/v1/data
```

**Response (200 OK):**
```json
{
  "data": [
    {
      "key": "user-123",
      "id": "user-123",
      "name": "John Doe",
      "type": "user",
      "metadata": {
        "createdAt": "2023-12-01T10:00:00.000Z",
        "updatedAt": "2023-12-01T10:00:00.000Z",
        "version": 1
      }
    }
  ],
  "count": 1,
  "timestamp": "2023-12-01T10:05:00.000Z"
}
```

### 5. Delete a Record

**Request:**
```bash
curl -X DELETE http://localhost:3000/api/v1/data/user-123
```

**Response (204 No Content):**
```
Status: 204 No Content
(Empty body)
```

### 6. Validation Error Example

**Request:**
```bash
curl -X POST http://localhost:3000/api/v1/data \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Invalid Record",
    "type": "invalid-type"
  }'
```

**Response (400 Bad Request):**
```json
{
  "error": "Validation failed",
  "details": [
    {
      "field": "",
      "message": "must have required property 'id'",
      "value": {...}
    },
    {
      "field": "/type",
      "message": "must be equal to one of the allowed values",
      "value": "invalid-type"
    }
  ],
  "timestamp": "2023-12-01T10:00:00.000Z"
}
```

## 🏗️ Architecture

### Project Structure

```
src/
├── app.js                 # Main application entry point
├── controllers/
│   └── dataController.js  # Business logic for data operations
├── middleware/
│   └── validation.js      # JSON schema validation middleware
├── routes/
│   └── dataRoutes.js      # API route definitions
├── schemas/
│   └── data-schema.json   # JSON schema for data validation
└── storage/
    └── keyValueStore.js   # In-memory key/value storage implementation
```

### Key Components

- **Express.js**: Web framework for handling HTTP requests
- **AJV**: JSON Schema validation library
- **Helmet**: Security middleware for HTTP headers
- **Morgan**: HTTP request logger middleware
- **CORS**: Cross-Origin Resource Sharing support

### Storage Layer

The key/value store provides:
- **In-memory storage** with Map data structure
- **Automatic metadata generation** (timestamps, versions, ETags)
- **ETag generation** for caching support
- **Version tracking** for each record

## 🧪 Testing

### Manual Testing with Health Check

```bash
# Check if the API is running
curl http://localhost:3000/health

# Expected response:
{
  "status": "healthy",
  "version": "1.0.0",
  "timestamp": "2023-12-01T10:00:00.000Z"
}
```

### Testing with Different Data Types

```bash
# Test with user data
curl -X POST http://localhost:3000/api/v1/data \
  -H "Content-Type: application/json" \
  -d '{"id": "user-1", "name": "Alice", "type": "user", "attributes": {"role": "admin"}}'

# Test with product data
curl -X POST http://localhost:3000/api/v1/data \
  -H "Content-Type: application/json" \
  -d '{"id": "prod-1", "name": "Laptop", "type": "product", "attributes": {"price": 999.99, "category": "electronics"}}'

# Test with order data
curl -X POST http://localhost:3000/api/v1/data \
  -H "Content-Type: application/json" \
  -d '{"id": "order-1", "name": "Order #1001", "type": "order", "attributes": {"total": 1299.99, "items": 3}}'
```

## 🛠️ Development

### Prerequisites

- Node.js 16+ 
- npm or yarn

### Installation

```bash
# Install dependencies
npm install

# Start development server with auto-reload
npm run dev

# Start production server
npm start
```

### Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `PORT` | `3000` | Server port number |
| `NODE_ENV` | `development` | Environment mode |

## 🤝 Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## 📝 License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## 🚀 Deployment

The API is production-ready and can be deployed to:

- **Docker**: Create a Dockerfile for containerization
- **Heroku**: Deploy with `git push heroku main`
- **AWS/Azure/GCP**: Deploy using serverless functions or VMs
- **Vercel/Netlify**: Deploy as serverless functions

## 📊 Performance Considerations

- **In-memory storage**: Fast access but limited by RAM
- **ETag caching**: Reduces bandwidth for unchanged resources
- **Request size limit**: 10MB JSON payload limit
- **CORS enabled**: Ready for frontend integration

## 🔒 Security Features

- **Helmet.js**: Sets security-related HTTP headers
- **Input validation**: JSON schema validation on all inputs
- **Error handling**: No sensitive data in error responses
- **CORS**: Controlled cross-origin access